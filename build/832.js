"use strict";(globalThis.webpackChunksimple_markers_map=globalThis.webpackChunksimple_markers_map||[]).push([[832],{832:(e,t,l)=>{l.r(t),l.d(t,{default:()=>v});var a=l(609);const r=(0,a.createContext)("block"),n=(0,a.createContext)("data"),o=(0,a.createContext)("input");var m=l(723),s=l(427);const i=({externalObject:e,submitTitle:t,submitDisabled:l,onSubmit:r})=>{const[n,o]=(0,a.useState)(null!=l&&l);return void 0!==e&&(e.setDisabledSubmit=e=>o(e)),(0,a.createElement)(s.Button,{disabled:n,variant:n?"":"primary",text:t,onClick:()=>{void 0!==r&&r()}})},c=({externalObject:e,title:t,openButton:l,openCallback:r,submitTitle:n,submitCallback:o,submitDisabled:c,...u})=>{const[d,b]=(0,a.useState)(!1),E=()=>{b(!1)};return(0,a.createElement)(a.Fragment,null,{...l,props:{...l.props,onClick:()=>{void 0!==r&&r(),b(!0)}}},d&&(0,a.createElement)(s.Modal,{size:"medium",title:t,onRequestClose:E},u.children,(0,a.createElement)(s.Flex,{style:{marginTop:"3rem"}},(0,a.createElement)(s.FlexItem,null,(0,a.createElement)(s.Button,{variant:"secondary",text:(0,m.__)("Cancel"),onClick:E})),(0,a.createElement)(s.FlexItem,null,(0,a.createElement)(i,{externalObject:e,submitTitle:n,submitDisabled:null!=c&&c,onSubmit:()=>{void 0!==o()&&o(),b(!1)}})))))};var u=l(330);let d;const b=function({marker:e}){const t=(0,a.useContext)(n),l=(0,a.useContext)(o),[r,m]=(0,a.useState)(e?.position);return(0,a.useEffect)((()=>{l.position=r}),[]),(0,a.createElement)("div",{className:"select-autocomplete"},(0,a.createElement)(u.A,{placeholder:"Type a location...",cacheOptions:!1,defaultOptions:!0,loadOptions:(e,t)=>{clearTimeout(d),d=setTimeout((()=>{((e,t)=>{e=encodeURIComponent(e.trim()),fetch(`https://nominatim.openstreetmap.org/search?q=${e}&format=json`).then((e=>e.json())).then((e=>t(e.map((e=>({label:e.display_name,lat:e.lat,lon:e.lon}))))))})(e,t)}),500)},onChange:e=>{const a=[e.lat,e.lon];m(a),l.position=a,void 0!==t?.marker?.setDisabledSubmit&&t.marker.setDisabledSubmit(!1),t.marker.setTitle(e.label)}}),(0,a.createElement)(s.Flex,{style:{margin:"0.5rem 0"}},(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)("strong",null,"Latitude"),": ",r?r[0]:""),(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)("strong",null,"Longitude"),": ",r?r[1]:"")),(0,a.createElement)("hr",null))},E=({title:e,defaultValue:t,onChangeCallback:l})=>{const[r,n]=(0,a.useState)(t),o=e=>{void 0!==l&&l(e),n(e)};return(0,a.useEffect)((()=>{o(t)}),[t]),(0,a.createElement)(a.Fragment,null,void 0===e?"":(0,a.createElement)("strong",null,e),(0,a.createElement)(s.TextControl,{style:{marginTop:"2px"},className:"blocks-form-text",value:r,onChange:e=>{o(e)}}))},k=({title:e,defaultValue:t,onChangeCallback:l})=>{const[r,n]=(0,a.useState)(t),o=e=>{void 0!==l&&l(e),n(e)};return(0,a.useEffect)((()=>{o(t)}),[t]),(0,a.createElement)(a.Fragment,null,void 0===e?"":(0,a.createElement)("strong",null,e),(0,a.createElement)(s.TextareaControl,{style:{marginTop:"2px"},className:"blocks-form-text",value:r,onChange:e=>{n(e),void 0!==l&&o(e)}}))},p=({marker:e})=>{var t;const l=(0,a.useContext)(n),r=(0,a.useContext)(o),[s,i]=(0,a.useState)(null!==(t=e?.title)&&void 0!==t?t:"");return l.marker.setTitle=e=>i(e),(0,a.createElement)(E,{title:(0,m.__)("Marker Title"),defaultValue:s,onChangeCallback:e=>{r.title=e}})},C=({marker:e})=>{var t;const l=(0,a.useContext)(o);return(0,a.createElement)(k,{title:(0,m.__)("Description"),defaultValue:null!==(t=e?.description)&&void 0!==t?t:"",onChangeCallback:e=>{l.description=e}})},x=({marker:e})=>((0,a.useContext)(o).id=e.id,(0,a.createElement)(s.Flex,{className:"blocks-form",direction:"column"},(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)(b,{marker:e})),(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)(p,{marker:e})),(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)(C,{marker:e})))),h=({marker:e})=>{const t=(0,a.useContext)(r),l=(0,a.useContext)(o);return(0,a.createElement)(s.Flex,{style:{width:"100%"}},(0,a.createElement)(s.FlexBlock,null,e.title),(0,a.createElement)(s.FlexItem,{style:{maxWidth:"70px"}},(0,a.createElement)(s.Flex,{gap:0},(0,a.createElement)(s.FlexItem,null,(0,a.createElement)(c,{title:(0,m.__)("Edit marker"),openButton:(0,a.createElement)(s.Button,{icon:"edit"}),submitTitle:(0,m.__)("Save changes"),submitCallback:()=>{const a=JSON.parse(JSON.stringify(t.attributes));a.markers=a.markers.filter((t=>t.id!==e.id)),t.setAttributes({...a,markers:[...a.markers,l]})}},(0,a.createElement)(x,{marker:e}))),(0,a.createElement)(s.FlexItem,null,(0,a.createElement)(c,{title:(0,m.__)("Delete marker"),openButton:(0,a.createElement)(s.Button,{style:{color:"red"},icon:"dismiss"}),submitTitle:(0,m.__)("Delete marker"),submitCallback:()=>{const l=JSON.parse(JSON.stringify(t.attributes));l.markers=l.markers.filter((t=>t.id!==e.id)),t.setAttributes(l)}},(0,a.createElement)("h1",null,"Do you want to delete the marker?"))))))},g=()=>{const e=(0,a.useContext)(r),t=(0,a.useContext)(n),l=(0,a.useContext)(o);return(0,a.createElement)(s.Flex,{direction:"column",style:{width:"100%"}},(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)(c,{externalObject:t.marker,title:(0,m.__)("New marker"),openButton:(0,a.createElement)(s.Button,{variant:"primary",text:(0,m.__)("Add new marker")}),submitTitle:(0,m.__)("Add marker"),submitDisabled:!0,submitCallback:()=>{const t=JSON.parse(JSON.stringify(e.attributes));e.setAttributes({...t,markers:[...t.markers,l]})}},(0,a.createElement)(x,{marker:{id:Date.now()}}))),0===e.attributes.markers.length?"":(0,a.createElement)(s.FlexBlock,null,(0,a.createElement)("hr",null),e.attributes?.markers?.map((e=>(0,a.createElement)(h,{key:e.id,marker:e})))))},v=e=>{var t;return(0,a.createElement)(r.Provider,{value:e},(0,a.createElement)(n.Provider,{value:{marker:{}}},(0,a.createElement)(o.Provider,{value:{}},(0,a.createElement)(s.PanelBody,{title:(0,m.__)("Markers")},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(g,null))),(0,a.createElement)(s.PanelBody,{title:(0,m.__)("Layer")},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.RadioControl,{selected:e?.attributes?.layer,options:LAYERS.map((e=>({label:e.name,value:e.layer}))),onChange:t=>{e.setAttributes({...e?.attributes,layer:t})}}))),(0,a.createElement)(s.PanelBody,{title:(0,m.__)("Map height")},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.RangeControl,{value:e?.attributes?.height,onChange:t=>{e.setAttributes({...e?.attributes,height:t})},step:10,min:300,max:2e3}))),e?.attributes?.markers.length>1?"":(0,a.createElement)(s.PanelBody,{title:(0,m.__)("Map zoom")},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.RangeControl,{value:e?.attributes?.zoom,onChange:t=>{e.setAttributes({...e?.attributes,zoom:t})},step:1,min:2,max:18}))),(0,a.createElement)(s.PanelBody,{title:(0,m.__)("Color markers")},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)(s.ColorPicker,{color:e?.attributes?.markersColor,onChange:t=>{e.setAttributes({...e?.attributes,markersColor:t})},enableAlpha:!1,defaultValue:null!==(t=e?.attributes?.markersColor)&&void 0!==t?t:"#006ba1"}))))))}}}]);